// Spam Key Rotation Addon
// This addon automatically cycles keys 1-4 repeatedly when toggled on by pressing B

(function() {
    // State variables for the spam feature
    let spamActive = false;
    let spamInterval = null;
    const SPAM_DELAY = 50; // ms between key presses
    const SPAM_KEYS = [49, 50, 51, 52]; // Key codes for 1, 2, 3, 4

    // Simulate key press (keydown + keyup)
    function simulateKeyPress(keyCode) {
        document.dispatchEvent(new KeyboardEvent("keydown", { keyCode: keyCode }));
        document.dispatchEvent(new KeyboardEvent("keyup", { keyCode: keyCode }));
    }

    // Start spamming keys 1-4
    function startSpamming() {
        if (spamInterval) return; // Don't start if already running
        
        let index = 0;
        spamInterval = setInterval(() => {
            simulateKeyPress(SPAM_KEYS[index]);
            index = (index + 1) % SPAM_KEYS.length;
        }, SPAM_DELAY);
        logActivity("Spam mode activated - cycling keys 1-4");
    }

    // Stop spamming keys
    function stopSpamming() {
        if (spamInterval) {
            clearInterval(spamInterval);
            spamInterval = null;
            logActivity("Spam mode deactivated");
        }
    }

    // Initialize function for the addon
    function initialize() {
        logActivity("Spam Key Rotation initialized");
        // Start in deactivated state
        updateStatus('spam-status', spamActive);
    }

    // Cleanup function
    function cleanup() {
        stopSpamming();
        spamActive = false;
        updateStatus('spam-status', false);
        logActivity("Spam Key Rotation cleaned up");
    }

    // Toggle spam mode
    function toggleSpamMode() {
        spamActive = !spamActive;
        updateStatus('spam-status', spamActive);
        // Removed flashButtonStatus to avoid yellow flash
        
        if (spamActive) {
            startSpamming();
        } else {
            stopSpamming();
        }
    }

    // Handle keydown events
    function onKeyDown(event) {
        if (event.key.toLowerCase() === 'b') {
            toggleSpamMode();
        }
    }

    // Register the feature with the addon manager
    window.gameBotAddonManager.registerFeature('spam-status', {
        label: 'Спам Перками (B)',
        initialActive: spamActive,
        initialize: initialize,
        cleanup: cleanup,
        onKeyDown: onKeyDown
    });
})();
